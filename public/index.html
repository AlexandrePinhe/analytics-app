<!DOCTYPE html>
<html>
<head>
  <title>Analytics App</title>
</head>
<body>
<h2>Usuários online</h2>
<p id="usersOnline"></p>
<h2>Páginas Acessadas</h2>
<ul id="pageViews"></ul>

<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-1.12.0.js"></script>

<script>
  var socket = io.connect('http://localhost:3000/');
  socket.on('news', function (data) {
    console.log(data);
    socket.emit('my other event', { my: 'data' });
  });
  /*socket.on('connect', function () {
    //socket.send(window.location);
    socket.on('pageview', function (msg) {
      $('#pageViews').append('<li>' + msg.url + '</li>');
    });
  });*/

  socket.on('connect', function () {
    socket.send(window.location.href);
    socket.on('pageview', function (msg) {
      $('#pageViews').append('<li>' + msg.url + msg.ip + '</li>');
    });

    socket.on('clients', function(clients) {
      $('#usersOnline').text(clients.connections);
    });

  });

  window.onhashchange = function () {
      socket.send(window.location.href);
  }

</script>

</body>
</html>